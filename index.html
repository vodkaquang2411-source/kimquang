<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Điểm Cá Nhân - Vũ Kim Quang</title>
    <!-- Sử dụng Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .card { margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4 text-primary">Bảng Điểm Cá Nhân - Vũ Kim Quang</h2>

        <!-- Form nhập liệu -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                Nhập thông tin môn học
            </div>
            <div class="card-body">
                <form id="studentForm">
                    <input type="hidden" id="studentId"> <!-- Dùng để lưu ID khi sửa -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="subject" class="form-label">Tên môn học</label>
                            <input type="text" class="form-control" id="subject" required placeholder="Nhập tên môn">
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="credits" class="form-label">Tín Chỉ</label>
                            <input type="number" class="form-control" id="credits" min="1" required>
                        </div>
                        
                        <div class="col-md-2 mb-3">
                            <label for="attendance" class="form-label">Chuyên Cần </label>
                            <input type="number" class="form-control" id="attendance" min="0" max="10" step="0.1" required>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="test" class="form-label">Kiểm Tra </label>
                            <input type="number" class="form-control" id="test" min="0" max="10" step="0.1" required>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="exam" class="form-label">Điểm Thi </label>
                            <input type="number" class="form-control" id="exam" min="0" max="10" step="0.1" required>
                        </div>
                        <div class="col-md-12 d-flex justify-content-end">
                            <button type="submit" class="btn btn-success me-2" id="btnSubmit">Thêm Mới</button>
                            <button type="button" class="btn btn-secondary d-none" id="btnCancel" onclick="resetForm()">Hủy</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Bảng hiển thị -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                Danh sách môn học đã lưu
            </div>
            <div class="card-body">
                <table class="table table-hover table-bordered text-center">
                    <thead class="table-light">
                        <tr>
                            <th>STT</th>
                            <th>Tên môn học</th>
                            <th>Số TC</th>
                            <th>C.Cần</th>
                            <th>K.Tra</th>
                            <th>Thi</th>
                            <th>Điểm HP</th>
                            <th>Điểm chữ</th>
                            <th>Hành Động</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody">
                        <!-- Dữ liệu sẽ được render tại đây -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Khóa lưu trữ riêng biệt để không bị trùng với các ứng dụng khác
        const STORAGE_KEY = 'vkq_grades';
        let students = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let isEditing = false;

        // Hàm tính điểm học phần: CC*0.2 + KT*0.3 + Thi*0.5
        function calculateCourseScore(att, test, exam) {
            return (parseFloat(att) * 0.2 + parseFloat(test) * 0.3 + parseFloat(exam) * 0.5).toFixed(2);
        }

        // Hàm quy đổi thang điểm chữ
        function convertToScale4(score) {
            if (score >= 8.5) return { grade: 'A', value: 4 };
            if (score >= 7.0) return { grade: 'B', value: 3 };
            if (score >= 5.5) return { grade: 'C', value: 2 };
            if (score >= 4.0) return { grade: 'D', value: 1 };
            return { grade: 'F', value: 0 };
        }

        // Hàm lưu dữ liệu vào localStorage
        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
        }

        // Hàm hiển thị bảng
        function renderTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            
            students.forEach((student, index) => {
                const hp = calculateCourseScore(student.attendance, student.test, student.exam);
                const scale4 = convertToScale4(hp);
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td class="text-start">${student.subject}</td>
                        <td>${student.credits}</td>
                        <td>${student.attendance}</td>
                        <td>${student.test}</td>
                        <td>${student.exam}</td>
                        <td class="fw-bold">${hp}</td>
                        <td><span class="badge bg-info text-dark">${scale4.grade} (${scale4.value})</span></td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editStudent(${index})">Sửa</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent(${index})">Xóa</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Xử lý sự kiện Submit form (Thêm hoặc Sửa)
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const subject = document.getElementById('subject').value;
            const credits = document.getElementById('credits').value;
            const attendance = document.getElementById('attendance').value;
            const test = document.getElementById('test').value;
            const exam = document.getElementById('exam').value;
            const id = document.getElementById('studentId').value;

            const data = { subject, credits, attendance, test, exam };

            if (isEditing) {
                students[id] = data;
                isEditing = false;
                document.getElementById('btnSubmit').innerText = 'Thêm Mới';
                document.getElementById('btnSubmit').classList.replace('btn-warning', 'btn-success');
                document.getElementById('btnCancel').classList.add('d-none');
            } else {
                students.push(data);
            }

            saveToLocalStorage();
            renderTable();
            resetForm();
        });

        // Hàm xóa môn học
        function deleteStudent(index) {
            if(confirm('Bạn có chắc muốn xóa môn học này?')) {
                students.splice(index, 1);
                saveToLocalStorage();
                renderTable();
            }
        }

        // Hàm chuẩn bị sửa môn học
        function editStudent(index) {
            const student = students[index];
            document.getElementById('subject').value = student.subject;
            document.getElementById('credits').value = student.credits;
            document.getElementById('attendance').value = student.attendance;
            document.getElementById('test').value = student.test;
            document.getElementById('exam').value = student.exam;
            document.getElementById('studentId').value = index;

            isEditing = true;
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.innerText = 'Cập Nhật';
            btnSubmit.classList.replace('btn-success', 'btn-warning');
            document.getElementById('btnCancel').classList.remove('d-none');
        }

        // Hàm reset form
        function resetForm() {
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
            isEditing = false;
            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.innerText = 'Thêm Mới';
            btnSubmit.classList.replace('btn-warning', 'btn-success');
            document.getElementById('btnCancel').classList.add('d-none');
        }

        // Khởi chạy lần đầu
        renderTable();
    </script>
</body>
</html>